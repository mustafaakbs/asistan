<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SIMBIOT v12 MOBILE</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <style>
        :root {
            --primary: #00f3ff;
            --bg: #0a0a12;
            --glass: rgba(20, 20, 30, 0.95);
            --border: 1px solid rgba(0, 243, 255, 0.2);
        }

        body {
            background: var(--bg); color: white; font-family: 'Rajdhani', sans-serif;
            margin: 0; padding: 0; overflow: hidden; height: 100vh; display: flex; flex-direction: column;
        }

        /* Üst Bar */
        .top-bar {
            padding: 15px; background: rgba(0,0,0,0.5); border-bottom: var(--border);
            display: flex; justify-content: space-between; align-items: center;
        }
        .logo { font-family: 'Orbitron'; color: var(--primary); font-size: 18px; letter-spacing: 2px; }
        .status { width: 8px; height: 8px; background: var(--primary); border-radius: 50%; box-shadow: 0 0 10px var(--primary); }

        /* Sohbet Alanı */
        .chat-container {
            flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 10px;
            background: radial-gradient(circle at center, #111 0%, #000 100%);
        }
        .msg { padding: 10px 15px; border-radius: 12px; max-width: 80%; font-size: 16px; line-height: 1.4; }
        .user { align-self: flex-end; background: #004d61; border: 1px solid var(--primary); color: white; }
        .ai { align-self: flex-start; background: #222; border: 1px solid #444; color: #ddd; }

        /* Alt Kontrol Barı */
        .bottom-bar {
            padding: 15px; background: #111; border-top: var(--border);
            display: flex; justify-content: center; gap: 20px; align-items: center; position: relative;
        }

        .action-btn {
            background: none; border: none; color: #666; font-size: 28px; cursor: pointer; transition: 0.3s;
        }
        .action-btn:hover { color: var(--primary); }

        .mic-btn {
            width: 65px; height: 65px; border-radius: 50%; background: transparent;
            border: 2px solid var(--primary); color: var(--primary); font-size: 30px;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 0 15px rgba(0, 243, 255, 0.2);
        }
        .mic-btn.listening { border-color: #ff0055; color: #ff0055; box-shadow: 0 0 25px #ff0055; animation: pulse 1s infinite; }

        /* --- KUMANDA MODU (OVERLAY) --- */
        .remote-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(5, 5, 10, 0.98); z-index: 999;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            transform: translateY(100%); transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(10px);
        }
        .remote-overlay.active { transform: translateY(0); }

        .remote-grid {
            display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; padding: 20px;
            width: 80%; max-width: 350px;
        }

        .r-btn {
            padding: 20px; background: #1a1a24; border: 1px solid #333; color: white;
            border-radius: 12px; font-family: 'Orbitron'; font-size: 14px; cursor: pointer;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .r-btn:active { background: var(--primary); color: black; }
        .r-btn i { font-size: 24px; margin-bottom: 5px; }
        .red { color: #ff4444; border-color: #ff4444; }
        .close-remote {
            position: absolute; top: 20px; right: 20px;
            background: none; border: none; color: white; font-size: 30px; cursor: pointer;
        }
        
        /* Ayarlar Modalı */
        .settings-modal {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 80%; background: #1a1a24; border: var(--border); padding: 20px;
            border-radius: 15px; z-index: 1000; display: none; text-align: center;
        }
        .input-box { width: 90%; padding: 10px; background: black; border: 1px solid #444; color: white; margin-bottom: 10px; }
        .save-btn { width: 100%; padding: 10px; background: var(--primary); border: none; font-weight: bold; cursor: pointer; }

        @keyframes pulse { 0% {transform: scale(1);} 50% {transform: scale(1.1);} 100% {transform: scale(1);} }
    </style>
</head>
<body>

<div id="settingsModal" class="settings-modal">
    <h3>SİSTEM AYARLARI</h3>
    <input type="password" id="apiKey" class="input-box" placeholder="Gemini API Key">
    <button onclick="fetchModels()" style="width:100%; margin-bottom:10px; background:#333; color:white; border:none; padding:8px;">Modelleri Güncelle</button>
    <select id="modelSelect" class="input-box"></select>
    <select id="voiceSelect" class="input-box"></select>
    <button class="save-btn" onclick="saveSettings()">KAYDET & KAPAT</button>
</div>

<div id="remoteOverlay" class="remote-overlay">
    <button class="close-remote" onclick="toggleRemote()"><i class="material-icons-round">expand_more</i></button>
    <h2 style="font-family:'Orbitron'; color:var(--primary); margin-bottom:30px;">MANUEL KONTROL</h2>
    
    <div class="remote-grid">
        <button class="r-btn red" onclick="send('POWER_TV')"><i class="material-icons-round">power_settings_new</i>TV</button>
        <button class="r-btn" onclick="send('HOME')"><i class="material-icons-round">home</i>MENU</button>
        <button class="r-btn red" onclick="send('POWER_SB')"><i class="material-icons-round">speaker</i>SB</button>

        <button class="r-btn" onclick="send('VOL_UP')"><i class="material-icons-round">volume_up</i>VOL+</button>
        <button class="r-btn" onclick="send('UP')"><i class="material-icons-round">keyboard_arrow_up</i></button>
        <button class="r-btn" onclick="send('CH_UP')"><i class="material-icons-round">add_circle</i>CH+</button>

        <button class="r-btn" onclick="send('LEFT')"><i class="material-icons-round">keyboard_arrow_left</i></button>
        <button class="r-btn" style="background:var(--primary); color:black;" onclick="send('OK')">OK</button>
        <button class="r-btn" onclick="send('RIGHT')"><i class="material-icons-round">keyboard_arrow_right</i></button>

        <button class="r-btn" onclick="send('VOL_DN')"><i class="material-icons-round">volume_down</i>VOL-</button>
        <button class="r-btn" onclick="send('DOWN')"><i class="material-icons-round">keyboard_arrow_down</i></button>
        <button class="r-btn" onclick="send('CH_DN')"><i class="material-icons-round">remove_circle</i>CH-</button>
        
        <button class="r-btn" onclick="send('NETFLIX')">NETFLIX</button>
        <button class="r-btn" onclick="send('BACK')">GERİ</button>
        <button class="r-btn" onclick="send('YOUTUBE')">YOUTUBE</button>
    </div>
</div>

<div class="top-bar">
    <div class="logo">SIMBIOT v12</div>
    <div class="status"></div>
</div>

<div id="chat" class="chat-container">
    <div class="msg ai">Simbiot Mobile hazır. Mikrofonu kullan veya kumandayı aç.</div>
</div>

<div class="bottom-bar">
    <button class="action-btn" onclick="openSettings()"><i class="material-icons-round">settings</i></button>
    
    <button id="micBtn" class="mic-btn"><i class="material-icons-round">mic</i></button>
    
    <button class="action-btn" onclick="toggleRemote()"><i class="material-icons-round">grid_view</i></button>
</div>

<script>
    // --- FIREBASE ---
    const firebaseConfig = { databaseURL: "https://asistan-489ec-default-rtdb.firebaseio.com" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    function send(cmd) { db.ref('tv_komut').set(cmd); }

    // --- UI FONKSİYONLARI ---
    function toggleRemote() {
        document.getElementById('remoteOverlay').classList.toggle('active');
    }
    function openSettings() {
        document.getElementById('settingsModal').style.display = 'block';
    }
    function saveSettings() {
        const key = document.getElementById('apiKey').value;
        const model = document.getElementById('modelSelect').value;
        localStorage.setItem('s_key', key);
        localStorage.setItem('s_model', model);
        document.getElementById('settingsModal').style.display = 'none';
        speak("Ayarlar kaydedildi.");
    }

    // --- SESLER VE MODELLER ---
    window.onload = () => {
        const k = localStorage.getItem('s_key');
        if(k) document.getElementById('apiKey').value = k;
        loadVoices();
    };

    const synth = window.speechSynthesis;
    function loadVoices() {
        const v = synth.getVoices();
        document.getElementById('voiceSelect').innerHTML = v.map((x,i)=>`<option value="${i}">${x.name}</option>`);
        const tr = v.findIndex(x => x.lang.includes('tr'));
        if(tr>-1) document.getElementById('voiceSelect').value=tr;
    }
    if(speechSynthesis.onvoiceschanged!==undefined)speechSynthesis.onvoiceschanged=loadVoices;

    async function fetchModels() {
        const key = document.getElementById('apiKey').value;
        try {
            const r = await fetch(`https://generativelanguage.googleapis.com/v1beta/models?key=${key}`);
            const d = await r.json();
            const s = document.getElementById('modelSelect'); s.innerHTML="";
            d.models.filter(m=>m.name.includes('gemini')).forEach(m=>{
                const o=document.createElement('option'); o.value=m.name.replace('models/',''); o.text=m.displayName; s.add(o);
            });
            alert("Modeller yüklendi!");
        } catch(e){alert("Hata!");}
    }

    function speak(t) {
        const u = new SpeechSynthesisUtterance(t);
        u.voice = synth.getVoices()[document.getElementById('voiceSelect').value];
        synth.speak(u);
    }

    function addMsg(t, type) {
        const d=document.createElement('div'); d.className=`msg ${type}`; d.innerText=t;
        const c=document.getElementById('chat'); c.appendChild(d); c.scrollTop=c.scrollHeight;
    }

    // --- GEMINI ---
    async function askGemini(text) {
        const key = localStorage.getItem('s_key');
        let model = localStorage.getItem('s_model') || 'gemini-1.5-flash';
        
        const prompt = `Sen asistan Simbiot. Kısa cevap ver. Sayıları algıla.
        KOMUTLARI PARANTEZE EKLE: [VOL_UP_X], [CH_UP], [CH_DN], [CH_X], [POWER_TV], [POWER_SB], [MUTE], [NETFLIX], [YOUTUBE]
        Kullanıcı: ${text}`;

        try {
            const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent?key=${key}`, {
                method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({contents:[{parts:[{text:prompt}]}]})
            });
            const d = await res.json();
            return d.candidates[0].content.parts[0].text;
        } catch(e){return "Hata";}
    }

    // --- MİKROFON ---
    const rec = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
    rec.lang='tr-TR';
    const mBtn = document.getElementById('micBtn');

    mBtn.onclick=()=>rec.start();
    rec.onstart=()=>mBtn.classList.add('listening');
    rec.onend=()=>mBtn.classList.remove('listening');
    rec.onresult=async(e)=>{
        const t = e.results[0][0].transcript;
        addMsg(t,'user');
        const resp = await askGemini(t);
        const cmd = resp.match(/\[(.*?)\]/);
        const clean = resp.replace(/\[.*?\]/g,"").trim();
        addMsg(clean,'ai'); speak(clean);
        if(cmd) send(cmd[1]);
    }
</script>
</body>
</html>
