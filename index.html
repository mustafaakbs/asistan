<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simbiot - TV AvcÄ±sÄ±</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <style>
        :root { --neon: #00f2ea; --bg: #0f172a; }
        body {
            font-family: 'Segoe UI', sans-serif;
            background: radial-gradient(circle at center, #1e293b, #000);
            color: white; display: flex; flex-direction: column; align-items: center; min-height: 100vh; margin: 0;
        }
        .container {
            width: 90%; max-width: 500px; padding: 20px;
            background: rgba(255,255,255,0.05); backdrop-filter: blur(10px);
            border-radius: 20px; border: 1px solid rgba(0, 242, 234, 0.3); margin-top: 20px;
            text-align: center;
        }
        .logo { width: 180px; margin-bottom: 15px; }
        
        #terminal {
            background: black; color: #39ff14; font-family: monospace; font-size: 0.8rem;
            height: 100px; overflow-y: auto; padding: 10px; text-align: left;
            border-radius: 10px; margin-bottom: 15px; border: 1px solid #333;
        }

        /* TARA VE BAÄžLAN ALANI */
        .scan-area {
            background: rgba(0, 242, 234, 0.1); padding: 15px; border-radius: 15px;
            border: 1px dashed var(--neon); margin-bottom: 15px;
        }
        
        select {
            width: 100%; padding: 12px; margin: 10px 0; border-radius: 10px;
            background: #111; color: white; border: 1px solid #444; font-size: 1rem;
        }

        .btn {
            padding: 12px; border: none; border-radius: 10px; cursor: pointer;
            font-weight: bold; width: 100%; margin-bottom: 5px; transition: 0.3s;
        }
        .btn-scan { background: #f39c12; color: white; } /* Turuncu */
        .btn-conn { background: var(--neon); color: black; } /* Mavi */
        
        .btn:active { transform: scale(0.98); }
        
        /* Loading Animasyonu */
        .scanning { animation: blink 1s infinite; }
        @keyframes blink { 50% { opacity: 0.5; } }

        /* Sohbet AlanÄ± */
        #chat-log { max-height: 150px; overflow-y: auto; text-align: left; margin-top:10px; }
        .msg { padding: 8px 12px; margin: 5px 0; border-radius: 10px; font-size: 0.9rem; }
        .user { background: #2980b9; align-self: flex-end; }
        .ai { background: #27ae60; align-self: flex-start; }
        
        .mic-btn {
            width: 70px; height: 70px; border-radius: 50%; border: none;
            background: #e74c3c; color: white; font-size: 35px; cursor: pointer;
        }
        .mic-btn.listening { background: #2ecc71; transform: scale(1.1); }
    </style>
</head>
<body>

<div class="container">
    <img src="logo.png" class="logo">
    <div id="terminal">> Simbiot HazÄ±r.</div>

    <div class="scan-area">
        <h3>ðŸ“¡ TV TarayÄ±cÄ±</h3>
        <button id="scanBtn" class="btn btn-scan" onclick="startScan()">NETWORK TARA (CihazlarÄ± Bul)</button>
        
        <select id="foundDevices">
            <option value="">Tarama bekleniyor...</option>
        </select>

        <button class="btn btn-conn" onclick="saveAndConnect()">SEÃ‡Ä°LÄ° TV'YE BAÄžLAN</button>
    </div>

    <input type="password" id="apiKey" placeholder="Gemini API Key" style="width:90%; padding:10px; margin-bottom:10px; border-radius:10px; border:none;">
    
    <button id="micBtn" class="mic-btn"><i class="material-icons-round">mic</i></button>
    <div id="chat-log"></div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyAdo6LaAge-EO_Q5SPbbAdInHC0H1OvA7c",
        authDomain: "asistan-489ec.firebaseapp.com",
        databaseURL: "https://asistan-489ec-default-rtdb.firebaseio.com",
        projectId: "asistan-489ec",
        storageBucket: "asistan-489ec.firebasestorage.app",
        messagingSenderId: "161041095710",
        appId: "1:161041095710:web:11747cc9b9499948c9e20f"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    function log(msg) {
        document.getElementById('terminal').innerHTML = `> ${msg}<br>` + document.getElementById('terminal').innerHTML;
    }

    // 1. TaramayÄ± BaÅŸlat
    function startScan() {
        log("Tarama komutu gÃ¶nderildi...");
        document.getElementById('scanBtn').classList.add('scanning');
        document.getElementById('scanBtn').innerText = "TaranÄ±yor... (Bekleyin)";
        
        // Simbiot'a 'SCAN' emri ver
        db.ref('tv_komut').set('SCAN_NETWORK');
        
        // Firebase'deki sonuÃ§larÄ± dinle
        db.ref('scan_result').on('value', (snap) => {
            const ip = snap.val();
            if(ip && ip !== "YOK") {
                const sel = document.getElementById('foundDevices');
                sel.innerHTML = ""; // Listeyi temizle
                
                let opt = document.createElement('option');
                opt.value = ip;
                opt.text = "Bulundu! Samsung TV (" + ip + ")";
                sel.appendChild(opt);
                
                log("Cihaz Bulundu: " + ip);
                document.getElementById('scanBtn').classList.remove('scanning');
                document.getElementById('scanBtn').innerText = "Tekrar Tara";
            }
        });
    }

    // 2. SeÃ§ili TV'yi Kaydet ve BaÄŸlan
    function saveAndConnect() {
        const ip = document.getElementById('foundDevices').value;
        if(ip) {
            db.ref('tv/ip').set(ip); // IP'yi kaydet
            db.ref('tv_komut').set('CONNECT_NOW'); // BaÄŸlanmaya zorla
            log("BaÄŸlantÄ± isteÄŸi gÃ¶nderildi: " + ip);
        } else {
            log("LÃ¼tfen listeden bir TV seÃ§in.");
        }
    }

    // ESP LoglarÄ±nÄ± Dinle
    db.ref('esp_log').on('value', (s) => { if(s.val()) log("ESP: " + s.val()); });

    // --- GEMINI & SES (Standart) ---
    const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
    recognition.lang = 'tr-TR';
    document.getElementById('micBtn').onclick = () => recognition.start();
    
    recognition.onresult = async (e) => {
        const text = e.results[0][0].transcript;
        // Basit Gemini isteÄŸi (KÄ±saltÄ±ldÄ±)
        // ... (Burada Ã¶nceki kodlardaki yapay zeka mantÄ±ÄŸÄ± Ã§alÄ±ÅŸÄ±r)
    };
</script>
</body>
</html>
