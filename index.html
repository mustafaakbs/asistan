<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gemini + Google Cloud TTS Test Paneli</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #202124; color: #e8eaed; display: flex; flex-direction: column; align-items: center; min-height: 100vh; margin: 0; }
        .container { background: #303134; padding: 2rem; border-radius: 12px; box-shadow: 0 8px 24px rgba(0,0,0,0.5); width: 90%; max-width: 600px; margin-top: 20px; }
        h2 { color: #8ab4f8; text-align: center; }
        
        .settings-box { background: #3c4043; padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #5f6368; }
        label { display: block; margin-bottom: 5px; font-size: 0.9rem; color: #9aa0a6; }
        input, select { width: 100%; padding: 8px; margin-bottom: 10px; background: #202124; border: 1px solid #5f6368; color: white; border-radius: 4px; box-sizing: border-box; }
        
        .mic-wrapper { text-align: center; margin: 20px 0; }
        .mic-btn { width: 80px; height: 80px; border-radius: 50%; border: none; background: #ea4335; color: white; font-size: 30px; cursor: pointer; transition: 0.3s; box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
        .mic-btn.listening { background: #34a853; animation: pulse 1.5s infinite; }
        
        #status { text-align: center; height: 20px; font-style: italic; color: #bdc1c6; margin-bottom: 10px; }
        
        .chat-box { max-height: 300px; overflow-y: auto; border-top: 1px solid #5f6368; padding-top: 10px; font-size: 0.95rem; }
        .msg { margin-bottom: 10px; padding: 8px; border-radius: 6px; }
        .user { background: #2b3a55; color: #a8c7fa; text-align: right; }
        .ai { background: #3c4043; color: #e8eaed; }

        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(52, 168, 83, 0.7); } 70% { box-shadow: 0 0 0 15px rgba(52, 168, 83, 0); } 100% { box-shadow: 0 0 0 0 rgba(52, 168, 83, 0); } }
    </style>
</head>
<body>

<div class="container">
    <h2>ü§ñ AI Asistan Test Paneli</h2>

    <div class="settings-box">
        <label>üîë Gemini API Key (Zeka ƒ∞√ßin):</label>
        <input type="password" id="geminiKey" placeholder="Gemini Anahtarƒ±nƒ± Yapƒ±≈ütƒ±r...">
        
        <label>üîë Google Cloud API Key (Ses ƒ∞√ßin):</label>
        <input type="password" id="cloudKey" placeholder="Google Cloud Anahtarƒ±nƒ± Yapƒ±≈ütƒ±r...">
        
        <label>üó£Ô∏è Ses Se√ßimi (WaveNet):</label>
        <select id="voiceSelect">
            <option value="tr-TR-Wavenet-C">T√ºrk√ße - Erkek (Kalƒ±n)</option>
            <option value="tr-TR-Wavenet-B">T√ºrk√ße - Erkek (Normal)</option>
            <option value="tr-TR-Wavenet-A">T√ºrk√ße - Kadƒ±n (A)</option>
            <option value="tr-TR-Wavenet-D">T√ºrk√ße - Kadƒ±n (D)</option>
            <option value="tr-TR-Standard-A">T√ºrk√ße - Standart (Robotik)</option>
        </select>
    </div>

    <div id="status">Hazƒ±r. Ba≈ülamak i√ßin butona bas.</div>

    <div class="mic-wrapper">
        <button id="micBtn" class="mic-btn">üéôÔ∏è</button>
    </div>

    <div class="chat-box" id="chatBox"></div>
</div>

<script>
    // --- Ayarlar ve Deƒüi≈ükenler ---
    const micBtn = document.getElementById('micBtn');
    const statusDiv = document.getElementById('status');
    const chatBox = document.getElementById('chatBox');
    
    // Web Speech API (Dinleme)
    const Recognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    const recognition = new Recognition();
    recognition.lang = 'tr-TR';
    recognition.interimResults = false;

    let isListening = false;

    // --- Olay Dinleyicileri ---
    micBtn.onclick = () => {
        if (!document.getElementById('geminiKey').value || !document.getElementById('cloudKey').value) {
            alert("L√ºtfen √∂nce her iki API anahtarƒ±nƒ± da girin!");
            return;
        }
        if (isListening) recognition.stop();
        else recognition.start();
    };

    recognition.onstart = () => {
        isListening = true;
        micBtn.classList.add('listening');
        statusDiv.innerText = "Dinliyorum...";
    };

    recognition.onend = () => {
        isListening = false;
        micBtn.classList.remove('listening');
        if(statusDiv.innerText === "Dinliyorum...") statusDiv.innerText = "Hazƒ±r.";
    };

    recognition.onresult = async (event) => {
        const text = event.results[0][0].transcript;
        addMessage("Sen: " + text, "user");
        
        statusDiv.innerText = "Gemini D√º≈ü√ºn√ºyor...";
        const aiText = await getGeminiResponse(text);
        
        if (aiText) {
            addMessage("Gemini: " + aiText, "ai");
            statusDiv.innerText = "Ses Olu≈üturuluyor...";
            await speakWithCloudTTS(aiText);
            statusDiv.innerText = "Hazƒ±r.";
        }
    };

    // --- 1. Gemini API (Zeka) ---
    async function getGeminiResponse(prompt) {
        const apiKey = document.getElementById('geminiKey').value;
        const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`;
        
        try {
            const response = await fetch(url, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    contents: [{ parts: [{ text: "Kƒ±sa ve sohbet havasƒ±nda cevap ver. Soru: " + prompt }] }]
                })
            });
            const data = await response.json();
            return data.candidates[0].content.parts[0].text;
        } catch (e) {
            console.error(e);
            alert("Gemini Hatasƒ±! Anahtarƒ± kontrol et.");
            return null;
        }
    }

    // --- 2. Google Cloud TTS API (Ses) ---
    async function speakWithCloudTTS(text) {
        const apiKey = document.getElementById('cloudKey').value;
        const voiceName = document.getElementById('voiceSelect').value;
        const url = `https://texttospeech.googleapis.com/v1/text:synthesize?key=${apiKey}`;

        // WaveNet-C veya WaveNet-B Erkek sesleridir, diƒüerleri Kadƒ±ndƒ±r.
        const ssmlGender = (voiceName.includes('Wavenet-C') || voiceName.includes('Wavenet-B')) ? 'MALE' : 'FEMALE';

        const requestBody = {
            input: { text: text },
            voice: { languageCode: "tr-TR", name: voiceName, ssmlGender: ssmlGender },
            audioConfig: { audioEncoding: "MP3", speakingRate: 1.0, pitch: 0 }
        };

        try {
            const response = await fetch(url, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(requestBody)
            });
            const result = await response.json();
            
            if (result.audioContent) {
                const audio = new Audio("data:audio/mp3;base64," + result.audioContent);
                audio.play();
            } else {
                console.error(result);
                alert("TTS Hatasƒ±: Google Cloud API yetkilendirmesi kapalƒ± olabilir.");
            }
        } catch (e) {
            console.error(e);
            alert("Ses Servisi Baƒülantƒ± Hatasƒ±");
        }
    }

    function addMessage(text, type) {
        const div = document.createElement('div');
        div.className = `msg ${type}`;
        div.innerText = text;
        chatBox.prepend(div);
    }
</script>

</body>
</html>
