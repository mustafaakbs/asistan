<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simbiot Maximum v9.0</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <style>
        :root { --neon: #00f2ea; --bg: #0f172a; }
        body {
            font-family: 'Segoe UI', sans-serif; background: radial-gradient(circle, #1e293b, #000);
            color: white; display: flex; flex-direction: column; align-items: center; margin: 0; padding: 20px;
        }
        .container { width: 100%; max-width: 450px; }
        .logo { width: 120px; display: block; margin: 0 auto 10px; filter: drop-shadow(0 0 8px var(--neon)); }
        
        #terminal {
            background: #000; color: #39ff14; font-family: monospace; font-size: 0.75rem;
            height: 80px; overflow-y: auto; padding: 10px; border-radius: 10px; border: 1px solid #333; margin-bottom: 10px;
        }
        #chat-log { height: 200px; overflow-y: auto; background: rgba(30, 41, 59, 0.7); border-radius: 15px; padding: 10px; margin-bottom: 10px; display: flex; flex-direction: column; border: 1px solid rgba(255,255,255,0.1); }
        .msg { padding: 8px 12px; margin: 4px 0; border-radius: 10px; font-size: 0.85rem; max-width: 85%; }
        .user { background: #0369a1; align-self: flex-end; }
        .ai { background: #334155; align-self: flex-start; }

        .settings-panel { background: rgba(30, 41, 59, 0.7); padding: 12px; border-radius: 15px; margin-bottom: 10px; }
        input, select { width: 100%; padding: 10px; margin: 4px 0; border-radius: 8px; background: #0f172a; color: white; border: 1px solid #334155; font-size: 0.8rem; }

        .mic-section { display: flex; justify-content: center; margin: 15px 0; }
        .mic-btn {
            width: 70px; height: 70px; border-radius: 50%; border: none;
            background: linear-gradient(135deg, var(--neon), #00c6ff);
            cursor: pointer; box-shadow: 0 0 15px rgba(0,242,234,0.3); transition: 0.2s;
        }
        .mic-btn.listening { transform: scale(1.1); background: #ef4444; box-shadow: 0 0 25px #ef4444; }
        .btn-clear { background: transparent; border: 1px solid #ef4444; color: #ef4444; width: 100%; padding: 8px; border-radius: 10px; cursor: pointer; font-size: 0.8rem; }
    </style>
</head>
<body>

<div class="container">
    <img src="logo.png" class="logo">
    <div id="terminal">> Simbiot IR Master HazÄ±r...</div>
    <div id="chat-log"></div>

    <div class="settings-panel">
        <input type="password" id="apiKey" placeholder="Gemini API Key">
        <div style="display: flex; gap: 5px;">
            <select id="voiceSelect"></select>
            <select id="modelSelect" onfocus="listModels()"><option>Model SeÃ§in</option></select>
        </div>
    </div>

    <div class="mic-section">
        <button id="micBtn" class="mic-btn"><i class="material-icons-round" style="font-size: 35px; color: #000;">mic</i></button>
    </div>

    <button class="btn-clear" onclick="clearAll()">GeÃ§miÅŸi Temizle</button>
</div>

<script>
    // Firebase BaÄŸlantÄ±sÄ±
    const firebaseConfig = { databaseURL: "https://asistan-489ec-default-rtdb.firebaseio.com" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    function log(msg) { const t = document.getElementById('terminal'); t.innerHTML = `> ${msg}<br>` + t.innerHTML; }

    // Sesler ve Modeller
    const synth = window.speechSynthesis;
    function loadVoices() {
        const v = synth.getVoices();
        document.getElementById('voiceSelect').innerHTML = v.map((s, i) => `<option value="${i}">${s.lang.includes('tr') ? 'ðŸ‡¹ðŸ‡· ' : ''}${s.name}</option>`).join('');
    }
    if (speechSynthesis.onvoiceschanged !== undefined) speechSynthesis.onvoiceschanged = loadVoices;

    async function listModels() {
        const key = document.getElementById('apiKey').value;
        if(!key) return;
        const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models?key=${key}`);
        const data = await res.json();
        document.getElementById('modelSelect').innerHTML = data.models.filter(m => m.name.includes('flash')).map(m => `<option value="${m.name}">${m.displayName}</option>`).join('');
    }

    let chatHistory = [];
    async function askSimbiot(text) {
        const key = document.getElementById('apiKey').value;
        const model = document.getElementById('modelSelect').value;
        
        const systemPrompt = `Sen Simbiot'sun. Her ÅŸeyi anÄ±nda yaparsÄ±n.
        KOMUT LÄ°STESÄ° (YanÄ±tÄ±n sonuna ekle):
        - GÃ¼Ã§: [POWER_TV], [POWER_SB]
        - Ses: [VOL_UP] (az), [VOL_UP_5] (Ã§ok), [VOL_DN] (az), [VOL_DN_5] (Ã§ok), [MUTE]
        - Kanal: [CH_UP], [CH_DN], [CH_X] (X kanal no)
        - Uygulama: [NETFLIX], [YOUTUBE], [WEB]
        - Navigasyon: [UP], [DOWN], [LEFT], [RIGHT], [OK], [BACK], [HOME]`;

        const payload = {
            contents: [{ role: "user", parts: [{ text: systemPrompt }] }, ...chatHistory, { role: "user", parts: [{ text: text }] }]
        };

        const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/${model}:generateContent?key=${key}`, {
            method: 'POST', body: JSON.stringify(payload)
        });
        const data = await res.json();
        return data.candidates[0].content.parts[0].text;
    }

    const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
    recognition.lang = 'tr-TR';

    document.getElementById('micBtn').onclick = () => recognition.start();
    recognition.onstart = () => document.getElementById('micBtn').classList.add('listening');
    recognition.onend = () => document.getElementById('micBtn').classList.remove('listening');

    recognition.onresult = async (e) => {
        const input = e.results[0][0].transcript;
        addMsg(input, 'user');
        
        const response = await askSimbiot(input);
        const cmdMatch = response.match(/\[(.*?)\]/);
        const textOnly = response.replace(/\[.*?\]/g, "").trim();

        addMsg(textOnly, 'ai');
        speak(textOnly);

        if(cmdMatch) {
            log("Sinyal: " + cmdMatch[1]);
            db.ref('tv_komut').set(cmdMatch[1]);
        }
        chatHistory.push({ role: "user", parts: [{ text: input }] }, { role: "model", parts: [{ text: response }] });
    };

    function addMsg(t, cl) {
        const d = document.createElement('div'); d.className = `msg ${cl}`; d.innerText = t;
        const c = document.getElementById('chat-log'); c.appendChild(d); c.scrollTop = c.scrollHeight;
    }

    function speak(t) {
        const u = new SpeechSynthesisUtterance(t);
        u.voice = synth.getVoices()[document.getElementById('voiceSelect').value];
        synth.speak(u);
    }

    function clearAll() { chatHistory = []; document.getElementById('chat-log').innerHTML = ""; log("SÄ±fÄ±rlandÄ±."); }
</script>
</body>
</html>
