<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>JARVIS AI - Mobile Pure</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    <style>
        :root { --primary: #00f2fe; --bg: #0a0e17; }
        body {
            font-family: 'Segoe UI', sans-serif; background: radial-gradient(circle at center, #141e30, #0a0e17);
            color: #e2e8f0; display: flex; flex-direction: column; align-items: center; min-height: 100vh; margin: 0; padding: 15px;
        }
        .container {
            background: rgba(15, 23, 42, 0.9); backdrop-filter: blur(20px); padding: 1.5rem; border-radius: 24px;
            width: 95%; max-width: 450px; text-align: center; border: 1px solid rgba(255, 255, 255, 0.1);
        }
        h2 { margin: 0 0 15px 0; color: var(--primary); font-weight: 800; letter-spacing: 1px; }
        input, select { 
            width: 100%; padding: 12px; margin-bottom: 10px; border-radius: 12px; 
            border: 1px solid rgba(255,255,255,0.1); background: rgba(0,0,0,0.5); 
            color: white; text-align: center; font-size: 1rem;
        }
        .btn-group { display: flex; gap: 8px; margin-bottom: 10px; }
        .action-btn { 
            flex: 1; padding: 12px; border-radius: 12px; border: none; cursor: pointer; 
            font-weight: bold; color: white; display: flex; align-items: center; justify-content: center; gap: 5px;
        }
        .btn-blue { background: #2563eb; } .btn-orange { background: #f59e0b; }
        .mic-btn { 
            width: 90px; height: 90px; border-radius: 50%; border: none; 
            background: #ef4444; color: white; font-size: 40px; cursor: pointer; 
            margin: 15px 0; transition: 0.3s;
        }
        .mic-btn.listening { background: #22c55e; box-shadow: 0 0 25px #22c55e; transform: scale(1.05); }
        #status { font-size: 0.9rem; color: var(--primary); margin-bottom: 10px; height: 20px; }
        #chat-log { 
            text-align: left; max-height: 200px; overflow-y: auto; 
            border-top: 1px solid rgba(255,255,255,0.1); padding-top: 10px; font-size: 0.9rem;
        }
        .terminal { 
            background: #000; color: #00ff00; font-family: monospace; font-size: 11px; 
            padding: 8px; border-radius: 8px; margin-top: 10px; height: 60px; overflow-y: auto; text-align: left;
        }
    </style>
</head>
<body>

<div class="container">
    <h2>âš¡ JARVIS PURE</h2>
    <div id="status">Sistem Beklemede</div>

    <input type="password" id="apiKey" placeholder="Gemini API Key Girin">
    
    <div class="btn-group">
        <button class="action-btn btn-orange" id="voiceInitBtn">1. SESÄ° UYANDIR</button>
        <button class="action-btn btn-blue" onclick="getModels()">2. MODELLERÄ° AL</button>
    </div>

    <select id="modelSelect"><option>Model seÃ§in...</option></select>
    <select id="voiceSelect"><option>Ses seÃ§in...</option></select>

    <button id="micBtn" class="mic-btn"><i class="material-icons-round">mic</i></button>

    <div class="terminal" id="term">> Log bekleniyor...</div>
    <div id="chat-log"></div>
</div>

<script>
    const synth = window.speechSynthesis;
    let voices = [];
    let chatHistory = [];

    // --- SES SÄ°STEMÄ° ---
    function loadVoices() {
        voices = synth.getVoices();
        const vSel = document.getElementById('voiceSelect');
        vSel.innerHTML = "";
        
        // TÃ¼rkÃ§e Ã¶ncelikli sÄ±rala
        const tr = voices.filter(v => v.lang.includes('tr'));
        const others = voices.filter(v => !v.lang.includes('tr'));
        
        [...tr, ...others].forEach(v => {
            let opt = document.createElement('option');
            opt.value = v.name;
            opt.text = (v.lang.includes('tr') ? "ðŸ‡¹ðŸ‡· " : "") + v.name;
            vSel.appendChild(opt);
        });
        logTerm("Sesler tarandÄ±: " + voices.length);
    }

    document.getElementById('voiceInitBtn').onclick = () => {
        loadVoices();
        const u = new SpeechSynthesisUtterance("Sistem hazÄ±r.");
        u.lang = 'tr-TR';
        synth.speak(u);
        document.getElementById('status').innerText = "Ses Aktif";
    };

    if (speechSynthesis.onvoiceschanged !== undefined) {
        speechSynthesis.onvoiceschanged = loadVoices;
    }

    function speak(text) {
        if (synth.speaking) synth.cancel();
        const u = new SpeechSynthesisUtterance(text);
        const selectedVoice = voices.find(v => v.name === document.getElementById('voiceSelect').value);
        if (selectedVoice) u.voice = selectedVoice;
        u.lang = 'tr-TR';
        u.onstart = () => document.getElementById('status').innerText = "Jarvis KonuÅŸuyor...";
        u.onend = () => document.getElementById('status').innerText = "Dinlemeye HazÄ±r";
        synth.speak(u);
    }

    // --- MÄ°KROFON SÄ°STEMÄ° ---
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    const recognition = new SpeechRecognition();
    recognition.lang = 'tr-TR';

    document.getElementById('micBtn').onclick = () => {
        try { recognition.start(); } catch(e) { recognition.stop(); }
    };

    recognition.onstart = () => {
        document.getElementById('micBtn').classList.add('listening');
        document.getElementById('status').innerText = "Sizi Dinliyorum...";
    };

    recognition.onend = () => {
        document.getElementById('micBtn').classList.remove('listening');
    };

    recognition.onresult = async (event) => {
        const text = event.results[0][0].transcript;
        addMsg(text, "user");
        document.getElementById('status').innerText = "DÃ¼ÅŸÃ¼nÃ¼yorum...";
        
        const response = await askGemini(text);
        if (response) {
            addMsg(response, "ai");
            speak(response);
        }
    };

    // --- GEMINI API ---
    async function askGemini(prompt) {
        const key = document.getElementById('apiKey').value;
        const model = document.getElementById('modelSelect').value;
        if(!key || !model) return "LÃ¼tfen Key ve Model seÃ§in.";

        try {
            const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/${model}:generateContent?key=${key}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    contents: [{ parts: [{ text: "Sen Jarvis'sin. Ã‡ok kÄ±sa ve TÃ¼rkÃ§e cevap ver: " + prompt }] }]
                })
            });
            const data = await res.json();
            return data.candidates[0].content.parts[0].text;
        } catch (error) {
            logTerm("Hata: API baÄŸlantÄ±sÄ± baÅŸarÄ±sÄ±z.");
            return "Bir hata oluÅŸtu.";
        }
    }

    // --- MODELLERÄ° LÄ°STELE ---
    async function getModels() {
        const key = document.getElementById('apiKey').value;
        if(!key) return alert("Key girin!");
        try {
            const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models?key=${key}`);
            const data = await res.json();
            const sel = document.getElementById('modelSelect');
            sel.innerHTML = "";
            data.models.forEach(m => {
                if(m.supportedGenerationMethods.includes("generateContent")) {
                    let opt = document.createElement('option');
                    opt.value = m.name; opt.text = m.displayName.replace("Gemini ", "");
                    sel.appendChild(opt);
                }
            });
            // Flash modelini otomatik seÃ§
            for(let i=0; i<sel.options.length; i++) if(sel.options[i].value.includes("flash")) sel.selectedIndex = i;
            logTerm("Modeller yÃ¼klendi.");
        } catch(e) { logTerm("Modeller alÄ±namadÄ±."); }
    }

    // --- LOG VE MESAJ ---
    function addMsg(text, type) {
        const log = document.getElementById('chat-log');
        log.innerHTML = `<div style="margin-bottom:10px; color:${type === 'user' ? '#93c5fd' : '#e2e8f0'}"><b>${type === 'user' ? 'Siz' : 'Jarvis'}:</b> ${text}</div>` + log.innerHTML;
    }

    function logTerm(m) {
        const t = document.getElementById('term');
        t.innerHTML = `> ${m}<br>` + t.innerHTML;
    }
</script>
</body>
</html>
