<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gemini Asistan (Model Bulucu)</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #0f172a;
            color: #f1f5f9;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
        }
        .container {
            background-color: #1e293b;
            padding: 2rem;
            border-radius: 16px;
            width: 90%;
            max-width: 500px;
            text-align: center;
            box-shadow: 0 10px 25px rgba(0,0,0,0.5);
            border: 1px solid #334155;
        }
        h2 { color: #38bdf8; margin-bottom: 20px; }
        
        /* Giri≈ü Alanlarƒ± */
        .input-group { display: flex; flex-direction: column; gap: 10px; margin-bottom: 20px; }
        
        input[type="password"] {
            padding: 12px; border-radius: 8px; border: 1px solid #475569;
            background-color: #334155; color: white; text-align: center; font-size: 1rem;
        }
        
        button.scan-btn {
            background: #f59e0b; color: #fff; border: none; padding: 12px;
            border-radius: 8px; font-weight: bold; cursor: pointer; transition: 0.2s;
        }
        button.scan-btn:hover { background: #d97706; }

        select {
            padding: 12px; border-radius: 8px; border: 1px solid #475569;
            background-color: #0f172a; color: #38bdf8; font-size: 1rem; cursor: pointer;
        }

        /* Mikrofon */
        .mic-btn {
            background: #ef4444; color: white; border: none;
            width: 80px; height: 80px; border-radius: 50%;
            font-size: 32px; cursor: pointer; margin: 0 auto;
            box-shadow: 0 5px 15px rgba(239, 68, 68, 0.4);
            display: flex; align-items: center; justify-content: center;
        }
        .mic-btn.listening { 
            background: #22c55e; 
            animation: pulse 1.5s infinite; 
        }
        
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.7); } 70% { box-shadow: 0 0 0 15px rgba(34, 197, 94, 0); } 100% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0); } }

        #status { margin-top: 15px; font-style: italic; color: #94a3b8; height: 20px; }
        #chat-log { text-align: left; max-height: 250px; overflow-y: auto; margin-top: 20px; border-top: 1px solid #334155; padding-top: 10px; }
        .msg { padding: 10px; margin-bottom: 8px; border-radius: 8px; }
        .user { background: #334155; color: #bae6fd; align-self: flex-end; }
        .ai { background: #020617; color: #e2e8f0; border: 1px solid #1e293b; }
        .error { background: #450a0a; color: #fca5a5; border: 1px solid #7f1d1d; }
    </style>
</head>
<body>

<div class="container">
    <h2>üõ†Ô∏è Model Tarayƒ±cƒ± & Asistan</h2>
    
    <div class="input-group">
        <input type="password" id="apiKey" placeholder="1. API Anahtarƒ±nƒ± Buraya Yapƒ±≈ütƒ±r">
        <button class="scan-btn" onclick="listModels()">2. Modelleri Tara (Listele)</button>
        <select id="modelSelect">
            <option value="" disabled selected>√ñnce tara butonuna bas...</option>
        </select>
    </div>

    <button id="micBtn" class="mic-btn">üéôÔ∏è</button>
    <div id="status">Bekleniyor...</div>
    <div id="chat-log"></div>
</div>

<script>
    const apiKeyInput = document.getElementById('apiKey');
    const modelSelect = document.getElementById('modelSelect');
    const statusText = document.getElementById('status');
    const chatLog = document.getElementById('chat-log');
    const micBtn = document.getElementById('micBtn');

    // Ses Tanƒ±ma
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    const recognition = new SpeechRecognition();
    recognition.lang = 'tr-TR';
    let isListening = false;
    const synth = window.speechSynthesis;

    // --- 1. MODELLERƒ∞ Lƒ∞STELEME FONKSƒ∞YONU ---
    async function listModels() {
        const apiKey = apiKeyInput.value.trim();
        if (!apiKey) { alert("Anahtar girin!"); return; }

        statusText.textContent = "Modeller aranƒ±yor...";
        modelSelect.innerHTML = "<option>Y√ºkleniyor...</option>";

        try {
            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models?key=${apiKey}`);
            const data = await response.json();

            if (data.error) {
                statusText.textContent = "Hata olu≈ütu.";
                alert("HATA: " + data.error.message);
                modelSelect.innerHTML = "<option>Hata!</option>";
                return;
            }

            modelSelect.innerHTML = ""; // Listeyi temizle
            let count = 0;

            // Sadece metin √ºretebilen modelleri bul
            data.models.forEach(model => {
                if (model.supportedGenerationMethods.includes("generateContent")) {
                    const opt = document.createElement("option");
                    // Model ismini olduƒüu gibi alƒ±yoruz (√∂rn: models/gemini-pro)
                    opt.value = model.name; 
                    opt.text = model.displayName + " (" + model.name.replace('models/', '') + ")";
                    modelSelect.appendChild(opt);
                    count++;
                }
            });

            if (count > 0) {
                statusText.textContent = `${count} model bulundu. Birini se√ß!`;
                // Genelde "gemini-1.5-flash" en iyisidir, onu otomatik se√ßmeye √ßalƒ±≈üalƒ±m
                for (let i = 0; i < modelSelect.options.length; i++) {
                    if (modelSelect.options[i].value.includes("1.5-flash")) {
                        modelSelect.selectedIndex = i;
                        break;
                    }
                }
            } else {
                statusText.textContent = "Uygun model bulunamadƒ±.";
            }

        } catch (e) {
            alert("Baƒülantƒ± hatasƒ±: " + e.message);
        }
    }

    // --- 2. KONU≈ûMA VE CEVAP ALMA ---
    micBtn.onclick = () => {
        if (!modelSelect.value || modelSelect.value.includes("Hata") || modelSelect.value.includes("√ñnce")) {
            alert("L√ºtfen √∂nce 'Modelleri Tara' butonuna basƒ±n ve listeden bir model se√ßin.");
            return;
        }
        if (isListening) recognition.stop();
        else recognition.start();
    };

    recognition.onstart = () => { isListening = true; micBtn.classList.add('listening'); statusText.textContent = "Dinliyorum..."; };
    recognition.onend = () => { isListening = false; micBtn.classList.remove('listening'); if(statusText.textContent==="Dinliyorum...") statusText.textContent="Hazƒ±r."; };

    recognition.onresult = async (event) => {
        const text = event.results[0][0].transcript;
        log("Sen: " + text, "user");
        statusText.textContent = "D√º≈ü√ºn√ºyor...";
        
        const response = await askGemini(text);
        if (response) {
            log("Asistan: " + response, "ai");
            speak(response);
            statusText.textContent = "Hazƒ±r.";
        }
    };

    async function askGemini(prompt) {
        const apiKey = apiKeyInput.value.trim();
        // Listeden se√ßilen model ismini (models/gemini-...) doƒürudan kullanƒ±yoruz
        const selectedModel = modelSelect.value; 
        
        const url = `https://generativelanguage.googleapis.com/v1beta/${selectedModel}:generateContent?key=${apiKey}`;

        try {
            const response = await fetch(url, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    contents: [{ parts: [{ text: "Kƒ±sa cevap ver. Soru: " + prompt }] }]
                })
            });

            const data = await response.json();

            if (data.error) {
                log("HATA: " + data.error.message, "error");
                return null;
            }
            
            return data.candidates[0].content.parts[0].text;

        } catch (error) {
            log("BAƒûLANTI HATASI: " + error.message, "error");
            return null;
        }
    }

    function speak(text) {
        if (synth.speaking) synth.cancel();
        const u = new SpeechSynthesisUtterance(text);
        u.lang = 'tr-TR';
        synth.speak(u);
    }

    function log(msg, type) {
        const d = document.createElement('div');
        d.className = "msg " + type;
        d.textContent = msg;
        chatLog.prepend(d);
    }
</script>
</body>
</html>
