<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>JARVIS MOBILE READY</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    <style>
        :root { --neon: #00f2fe; --bg: #0f172a; }
        body { 
            font-family: 'Segoe UI', sans-serif; background: var(--bg); color: white; 
            margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center;
            height: 100vh; justify-content: center;
        }
        .container {
            background: rgba(30, 41, 59, 0.9); padding: 25px; border-radius: 30px;
            width: 100%; max-width: 400px; text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5); border: 1px solid #334155;
        }
        input, select {
            width: 100%; padding: 15px; margin: 10px 0; border-radius: 12px;
            background: #1e293b; color: white; border: 1px solid #475569; font-size: 1rem;
        }
        .mic-btn {
            width: 100px; height: 100px; border-radius: 50%; border: none;
            background: #ef4444; color: white; font-size: 45px; cursor: pointer;
            margin: 20px 0; transition: 0.3s;
        }
        .mic-btn.active {
            background: #22c55e; box-shadow: 0 0 30px rgba(34, 197, 94, 0.6);
            transform: scale(1.1);
        }
        #status { font-weight: bold; color: var(--neon); margin-bottom: 10px; height: 20px; }
        #chat-box { 
            text-align: left; max-height: 150px; overflow-y: auto; 
            font-size: 0.9rem; padding: 10px; background: rgba(0,0,0,0.2); border-radius: 10px;
        }
        .btn-init {
            background: #f59e0b; color: white; border: none; padding: 15px;
            border-radius: 12px; width: 100%; font-weight: bold; cursor: pointer;
            margin-bottom: 15px; text-transform: uppercase;
        }
    </style>
</head>
<body>

<div class="container">
    <h2>JARVIS PRO</h2>
    <div id="status">Bekleniyor...</div>

    <input type="password" id="apiKey" placeholder="Gemini API Key Girin">
    
    <button class="btn-init" id="initBtn">1. Sistemi ve Sesi BaÅŸlat</button>
    
    <select id="voiceSelect"><option>Ses Bekleniyor...</option></select>

    <button id="micBtn" class="mic-btn"><i class="material-icons-round">mic</i></button>

    <div id="chat-box">Sohbet burada gÃ¶rÃ¼necek...</div>
</div>

<script>
    const apiKeyInput = document.getElementById('apiKey');
    const voiceSelect = document.getElementById('voiceSelect');
    const micBtn = document.getElementById('micBtn');
    const statusText = document.getElementById('status');
    const chatBox = document.getElementById('chat-box');
    const initBtn = document.getElementById('initBtn');

    const synth = window.speechSynthesis;
    let voices = [];

    // --- SESLERÄ° YÃœKLE (MOBÄ°L UYUMLU) ---
    function loadVoices() {
        voices = synth.getVoices();
        voiceSelect.innerHTML = "";
        
        // Sadece TÃ¼rkÃ§e sesleri ayÄ±r
        const trVoices = voices.filter(v => v.lang.includes('tr') || v.lang.includes('TR'));
        
        if (trVoices.length > 0) {
            trVoices.forEach(v => {
                let opt = document.createElement('option');
                opt.value = v.name;
                opt.text = "ðŸ‡¹ðŸ‡· " + v.name;
                voiceSelect.appendChild(opt);
            });
        } else {
            let opt = document.createElement('option');
            opt.text = "VarsayÄ±lan TÃ¼rkÃ§e Sesi";
            voiceSelect.appendChild(opt);
        }
        statusText.innerText = "Sistem ve Sesler HazÄ±r";
    }

    // Mobilde kullanÄ±cÄ± etkileÅŸimi olmadan ses Ã§alÄ±ÅŸmaz!
    initBtn.onclick = () => {
        loadVoices();
        const welcome = new SpeechSynthesisUtterance("Sistem baÅŸlatÄ±ldÄ±, sizi dinliyorum.");
        welcome.lang = 'tr-TR';
        synth.speak(welcome);
        initBtn.style.display = "none"; // BaÅŸladÄ±ktan sonra butonu gizle
    };

    if (speechSynthesis.onvoiceschanged !== undefined) {
        speechSynthesis.onvoiceschanged = loadVoices;
    }

    function speak(text) {
        if (synth.speaking) synth.cancel();
        const utterance = new SpeechSynthesisUtterance(text);
        
        const selectedVoice = voices.find(v => v.name === voiceSelect.value);
        if (selectedVoice) {
            utterance.voice = selectedVoice;
            utterance.lang = selectedVoice.lang;
        } else {
            utterance.lang = 'tr-TR';
        }
        
        utterance.onstart = () => statusText.innerText = "Jarvis KonuÅŸuyor...";
        utterance.onend = () => statusText.innerText = "HazÄ±r";
        
        synth.speak(utterance);
    }

    // --- MÄ°KROFON (STT) ---
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    const recognition = new SpeechRecognition();
    recognition.lang = 'tr-TR';
    recognition.interimResults = false;

    micBtn.onclick = () => {
        try {
            recognition.start();
        } catch(e) {
            console.log("Zaten dinliyor");
        }
    };

    recognition.onstart = () => {
        micBtn.classList.add('active');
        statusText.innerText = "Dinliyorum...";
    };

    recognition.onend = () => {
        micBtn.classList.remove('active');
        statusText.innerText = "DÃ¼ÅŸÃ¼nÃ¼yorum...";
    };

    recognition.onresult = async (event) => {
        const text = event.results[0][0].transcript;
        chatBox.innerHTML = `<b>Siz:</b> ${text}<br>` + chatBox.innerHTML;
        
        const response = await askGemini(text);
        if (response) {
            chatBox.innerHTML = `<b>Jarvis:</b> ${response}<br>` + chatBox.innerHTML;
            speak(response);
        }
    };

    // --- GEMINI BAÄžLANTISI ---
    async function askGemini(prompt) {
        const key = apiKeyInput.value.trim();
        if(!key) { alert("LÃ¼tfen API Key girin!"); return; }

        try {
            const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${key}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    contents: [{ parts: [{ text: "Sen kÄ±sa ve Ã¶z cevap veren zeki bir asistansÄ±n. Soru: " + prompt }] }]
                })
            });
            const data = await res.json();
            return data.candidates[0].content.parts[0].text;
        } catch (error) {
            chatBox.innerHTML = `<span style="color:red">Hata: API Key yanlÄ±ÅŸ veya internet yok.</span><br>` + chatBox.innerHTML;
            return null;
        }
    }
</script>
</body>
</html>
