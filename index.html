<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simbiot Pro v8.5</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <style>
        :root { --neon: #00f2ea; --bg: #0f172a; --panel: rgba(30, 41, 59, 0.7); }
        body {
            font-family: 'Segoe UI', sans-serif; background: radial-gradient(circle, #1e293b, #000);
            color: white; display: flex; flex-direction: column; align-items: center; min-height: 100vh; margin: 0; padding: 20px;
        }
        .container { width: 100%; max-width: 450px; }
        .logo { width: 150px; display: block; margin: 0 auto 20px; filter: drop-shadow(0 0 10px var(--neon)); }
        
        /* Terminal & Chat */
        #terminal {
            background: #000; color: #39ff14; font-family: monospace; font-size: 0.8rem;
            height: 100px; overflow-y: auto; padding: 10px; border-radius: 10px; border: 1px solid #333; margin-bottom: 10px;
        }
        #chat-log { height: 180px; overflow-y: auto; background: var(--panel); border-radius: 15px; padding: 10px; margin-bottom: 10px; display: flex; flex-direction: column; }
        .msg { padding: 8px 12px; margin: 4px 0; border-radius: 10px; font-size: 0.9rem; max-width: 80%; }
        .user { background: #0369a1; align-self: flex-end; }
        .ai { background: #334155; align-self: flex-start; }

        /* Ayarlar Paneli */
        .settings-panel { background: var(--panel); padding: 15px; border-radius: 15px; border: 1px solid rgba(255,255,255,0.1); margin-bottom: 10px; }
        input, select { width: 100%; padding: 10px; margin: 5px 0; border-radius: 8px; background: #0f172a; color: white; border: 1px solid #334155; box-sizing: border-box; }

        /* Kontrol ButonlarÄ± */
        .mic-section { display: flex; justify-content: center; margin: 20px 0; }
        .mic-btn {
            width: 80px; height: 80px; border-radius: 50%; border: none;
            background: linear-gradient(135deg, var(--neon), #00c6ff);
            cursor: pointer; box-shadow: 0 0 20px rgba(0,242,234,0.4); transition: 0.3s;
        }
        .mic-btn.listening { transform: scale(1.2); background: #ef4444; box-shadow: 0 0 30px #ef4444; }
        .btn-clear { background: transparent; border: 1px solid #ef4444; color: #ef4444; width: 100%; padding: 10px; border-radius: 10px; cursor: pointer; }
    </style>
</head>
<body>

<div class="container">
    <img src="logo.png" class="logo">
    
    <div id="terminal">> Simbiot Sistemi Aktif...</div>

    <div id="chat-log"></div>

    <div class="settings-panel">
        <input type="password" id="apiKey" placeholder="Gemini API Key">
        <div style="display: flex; gap: 5px;">
            <select id="voiceSelect"><option>Ses Bekleniyor...</option></select>
            <select id="modelSelect" onfocus="listModels()"><option>Model SeÃ§in</option></select>
        </div>
    </div>

    <div class="mic-section">
        <button id="micBtn" class="mic-btn"><i class="material-icons-round" style="font-size: 40px; color: #000;">mic_none</i></button>
    </div>

    <button class="btn-clear" onclick="clearHistory()">GeÃ§miÅŸi ve Sohbeti Temizle</button>
</div>

<script>
    // Firebase YapÄ±landÄ±rmasÄ±
    const firebaseConfig = { databaseURL: "https://asistan-489ec-default-rtdb.firebaseio.com" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    function log(msg) { const t = document.getElementById('terminal'); t.innerHTML = `> ${msg}<br>` + t.innerHTML; }

    // Ses ve Model Listeleme
    const synth = window.speechSynthesis;
    function loadVoices() {
        const sel = document.getElementById('voiceSelect');
        const voices = synth.getVoices();
        sel.innerHTML = voices.map((v, i) => `<option value="${i}">${v.lang.includes('tr') ? 'ðŸ‡¹ðŸ‡· ' : ''}${v.name}</option>`).join('');
    }
    if (speechSynthesis.onvoiceschanged !== undefined) speechSynthesis.onvoiceschanged = loadVoices;

    async function listModels() {
        const key = document.getElementById('apiKey').value;
        if(!key) return;
        const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models?key=${key}`);
        const data = await res.json();
        document.getElementById('modelSelect').innerHTML = data.models.filter(m => m.name.includes('flash')).map(m => `<option value="${m.name}">${m.displayName}</option>`).join('');
    }

    // Gemini BaÄŸlantÄ±sÄ± ve Komut Analizi
    let chatHistory = [];
    async function askGemini(text) {
        const key = document.getElementById('apiKey').value;
        const model = document.getElementById('modelSelect').value;
        
        // Simbiot'un "ZekasÄ±" ve "Komut KitaplÄ±ÄŸÄ±"
        const systemPrompt = `Sen Simbiot'sun. Ev asistanÄ±sÄ±n. KullanÄ±cÄ±yÄ± anla ve komut Ã¼ret.
        KOMUTLAR (CÃ¼mle sonuna ekle):
        - Televizyonu/Ses sistemini aÃ§/kapat: [POWER_TV], [POWER_SB]
        - Sesi arttÄ±r/azalt (5 kademe): [VOL_UP_5], [VOL_DOWN_5]
        - Kanal ileri/geri: [CH_UP], [CH_DOWN]
        - Kanal 15 (veya herhangi rakam) git: [CH_15]
        - Uygulamalar: [NETFLIX], [YOUTUBE], [BROWSER]
        Ã–rn: "Sesi arttÄ±r" -> "Tabii sesi aÃ§Ä±yorum. [VOL_UP_5]"`;

        const payload = {
            contents: [{ role: "user", parts: [{ text: systemPrompt }] }, ...chatHistory, { role: "user", parts: [{ text: text }] }]
        };

        const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/${model}:generateContent?key=${key}`, {
            method: 'POST', body: JSON.stringify(payload)
        });
        const data = await res.json();
        return data.candidates[0].content.parts[0].text;
    }

    // Sesli Komut BaÅŸlatma
    const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
    recognition.lang = 'tr-TR';

    document.getElementById('micBtn').onclick = () => recognition.start();
    recognition.onstart = () => document.getElementById('micBtn').classList.add('listening');
    recognition.onend = () => document.getElementById('micBtn').classList.remove('listening');

    recognition.onresult = async (e) => {
        const text = e.results[0][0].transcript;
        addMsg(text, 'user');
        
        const response = await askGemini(text);
        const cmd = response.match(/\[(.*?)\]/);
        const replyText = response.replace(/\[.*?\]/g, "").trim();

        addMsg(replyText, 'ai');
        speak(replyText);

        if(cmd) {
            log("Komut: " + cmd[1]);
            db.ref('tv_komut').set(cmd[1]);
        }
        chatHistory.push({ role: "user", parts: [{ text: text }] }, { role: "model", parts: [{ text: response }] });
    };

    function addMsg(text, type) {
        const d = document.createElement('div');
        d.className = `msg ${type}`; d.innerText = text;
        const chat = document.getElementById('chat-log');
        chat.appendChild(d); chat.scrollTop = chat.scrollHeight;
    }

    function speak(text) {
        const msg = new SpeechSynthesisUtterance(text);
        const voices = synth.getVoices();
        msg.voice = voices[document.getElementById('voiceSelect').value];
        synth.speak(msg);
    }

    function clearHistory() {
        chatHistory = [];
        document.getElementById('chat-log').innerHTML = "";
        log("GeÃ§miÅŸ temizlendi.");
    }
</script>
</body>
</html>
